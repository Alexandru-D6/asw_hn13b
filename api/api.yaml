openapi: 3.0.1
info:
  version: 1.0.0
  title: Hacker news - HBN13
  description: "This is the Open API documentation for the REST API of our beloved application **Hacker news** deployed at <https://asw-api-demo.herokuapp.com/>. <br>All operations are executable. Only one operation requires authentication: `deleteComment`. In this case, you must **Authorize** your request by providing the api_key vaule you got when you created the comment."
servers:
  - url: 'https://http://54.198.177.164:8080/API/v1.0'
paths:
  /submissions/news:
    get:
      tags:
      - Submissions
      summary: Llistat de submissions de tipus news.
      description: Retorna el llistat de submissions ordenat segons el número de likes.
      
      responses:
        '200':
          description: Successful operation
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AddTweetResult'
                
  /submissions/newest:
    get:
      tags:
      - Submissions
      summary: Llistat de submissions de tipus newest.
      description: Retorna el llistat de submissions ordenat de més recents a menys. 
      responses:
        '200':
          description: Successful operation
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AddTweetResult'
                
  /submissions/ask:
    get:
      tags:
      - Submissions
      summary: Llistat de submissions de tipus ask.
      description: Retorna el llistat de publicacions de tipus ask de l'aplicació.
      responses:
        '200':
          description: Seccessful operation
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AddTweetResult'
  
  /submission/{submissionId}:
    get:
      tags:
      - Submissions
      summary: Troba una submission segons el seu id.
      description: Retorna el contingut de la publicacio i tots els seus comentaris. 
      parameters:
      - name: submissionId
        in: path
        description: ID de la Submission a buscar
        required: true
        schema:
          type: integer
      responses:
        '200':
          description: Successful operation
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Tweet'
        '400':
          description: 'Error: Bad Request'
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Tweet'
              examples:
                errorExample:
                  $ref: '#/components/examples/error400'
                400_insuficient_parameters:
                  $ref: '#/components/examples/error400_insuficient_parameters'
        '404':
          description: 'Error: Not Found'
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResult'
              examples:
                errorExample:
                  $ref: '#/components/examples/error404
                  
  /submission/{id}/edit:
    put:
      tags:
        - comments
      summary: Editeu un comentari donat el seu identificador
      parameters:
        - name: id
          in: path
          description: ID del commentari a editar
          required: true
          schema:
            type: integer
            format: int64
      requestBody:
        description: Proporcioneu el contingut del nou comentari
        content:
          application/json:
            schema:
              required:
                - comment
              type: object
              properties:
                comment:
                  type: string
                  minLength: 4
                  maxLength: 280
                  example: My new comment
        required: true
      responses:
        '203':
          description: Comment edited
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AddCommentResult'
        '408':
          description: 'Error: Bad Request'
              
        '401':
          description: 'Error: Unauthorized'
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResult'
              examples:
                Unauthorized:
                  value: |-
                    {
                        "status": 401,
                        "error": "Unauthorized",
                        "message": "API key not found"
                    }
        '403':
          description: 'Error: Forbidden'
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResult'
              examples:
                IncorrectApiKey:
                  value: |-
                    {
                        "status": 403,
                        "error": "Forbidden",
                        "message": "Incorrect apiKey"
                    }
        '409':
          description: 'Error: Not Found'
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResult'
              examples:
                NotFound:
                  value: |-
                    {
                        "status": 404,
                        "error": "Not Found",
                        "message": "Comment with id: 123 doesn't exist in our database"
                    }
      security:
      - ApiKeyAuth: []
    
  
  /submissions/create:
    post:
      tags:
      - Submissions
      summary: Crea una submission
      description: Crea una nova publicació de l'usuari que l'esta creant. 
      requestBody:
        description: Es requereix el titol, el text o la url
        content: 
          application/json:
            schema:
              required:
              - title
              - text
              - url
              type: object
              properties:
                title: 
                  type: string
                  minLength: 4
                  example: Hello world!
                text: 
                  type: string
                  minLength: 4
                  example: Today is the second delivery
                url:
                  type: string
                  example: https://www.eunoia.es/
      responses:
        '200':
          description: Created submission
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Tweet'
        '400':
          description: 'Error: Bad Request'
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResult'
              examples:
                errorExample:
                  $ref: '#/components/examples/error400'
        '401':
          description: 'Error: Unauthorized'
          content:
          application/json:
            schema:
              $ref: '#/components/schemas/ErrorResult'
            examples:
              errorExample:
                $ref: '#/components/examples/error401'
        '403':
          description: 'Error: Forbidden'
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResult'
              examples:
                errorExample:
                  $ref: '#/components/examples/error403'
      security:
      - ApiKeyAuth: []
          
          
  /submissions/{id}/upvote:
    put:
      tags:
      - Submissions
      summary: Vota una publicació
      description: Vota una publicació que d'un altre usuari
      parameters:
      - name: id
        in: path
        description: ID de la submission a votar. 
        required: true
        schema:
          type: integer
      responses:
        '200':
          description: Submission voted
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Tweet'
        '401':
          description: 'Error: Unauthorized'
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResult'
              examples:
                errorExample:
                  $ref: '#/components/examples/error401'
        '403':
          description: 'Error: Forbidden'
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResult'
              examples:
                errorExample:
                  $ref: '#/components/examples/error403'
        '404':
          description: 'Error: Not Found'
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResult'
      security:
      - ApiKeyAuth: []
              
              
  /submission/{id}/unvote:
    put:
      tags:
      - Submissions
      summary: Desfà la votació d'una publicació
      description: Borra la votació d'una publicació que ha votat anteriorment.
      parameters:
      - name: id
        in: path
        description: ID de la submission a desvotar. 
        required: true
        schema:
          type: integer
      responses:
        '200':
          description: Submission unvoted
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Tweet'
        '400':
          description: 'Error: Bad Request'
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResult'
        '401':
          description: 'Error: Unauthorized'
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResult'
        '404':
          description: 'Error: Not Found'
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResult'
      security:
      - ApiKeyAuth: []
  
  /comments:
    post:
      tags:
      - comments
      summary: Adds a new Comment to the Hacker News
      operationId: addComment
      requestBody:
        description: Provide the author & content of the new Comment
        content:
          application/json:
            schema:
              required:
              - author
              - content
              type: object
              properties:
                author:
                  type: string
                  minLength: 4
                  example: 'My name'
                content:
                  type: string
                  minLength: 4
                  maxLength: 280
                  example: 'My content'
        required: true
      responses:
        201:
          description: Comment created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AddCommentResult'
        400:
          description: 'Error: Bad Request'
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResult'
              examples:
                errorExample:
                  $ref: '#/components/examples/error400'
  /comment/{id}:
    get:
      tags:
      - comments
      summary: Finds a Commnent by its ID
      description: Returns a single Comment
      operationId: getCommentById
      parameters:
      - name: commentId
        in: path
        description: ID of Comment to return
        required: true
        schema:
          type: integer
          format: int64
      responses:
        200:
          description: successful operation
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Comment'
        404:
          description: 'Error: Not Found'
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResult'
              examples:
                errorExample:
                  $ref: '#/components/examples/error404'
    delete:
      tags:
      - comments
      summary: Deletes a Comment
      operationId: deleteComment
      parameters:
      - name: commentId
        in: path
        description: Comment id to delete
        required: true
        schema:
          type: integer
          format: int64
      responses:
        204:
          description: Comment deleted
          content:
            application/json: {}
        404:
          description: 'Error: Not Found'
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResult'
              examples:
                errorExample:
                  $ref: '#/components/examples/error404'
        401:
          description: 'Error: Unauthorized'
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResult'
              examples:
                errorExample:
                  $ref: '#/components/examples/error401'
        403:
          description: 'Error: Forbidden'
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResult'
              examples:
                errorExample:
                  $ref: '#/components/examples/error403'
      security:
      - ApiKeyAuth: []
  
  /comments/{id}/edit:
    post:
      tags:
      - comments
      summary: Edit a Comment given its ID
      operationId: editComment
      requestBody:
        description: Provide the author & content of the new Comment
        content:
          application/json:
            schema:
              required:
              - author
              - content
              type: object
              properties:
                author:
                  type: string
                  minLength: 4
                  example: 'My name'
                content:
                  type: string
                  minLength: 4
                  maxLength: 280
                  example: 'My content'
        required: true
      responses:
        201:
          description: Comment created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AddCommentResult'
        400:
          description: 'Error: Bad Request'
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResult'
              examples:
                errorExample:
                  $ref: '#/components/examples/error400'
  
  /comments/{id}/upvote:
    put:
      tags:
      - comments
      summary: Upvote a Comment
      parameters:
      - name: id
        in: path
        description: Comment id to upvote
        required: true
        schema:
          type: integer
          format: int64
      responses:
        '200':
          description: Upvoted Comment
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Comment'
              examples:
                UpvotedComment:
                  value: |-
                    {
                        "status": 200,
                        "message": "User with id: 1 has successfully upvoted comment with id: 2",
                        "comment": {
                            "UpVotes": 1,
                            "id": 2,
                            "author": "Alexandru-D6",
                            "comment": "dfgsdgfsdfgdsfdfd",
                            "created_at": "2022-05-09T21:31:04.594Z",
                            "id_submission": 2,
                            "id_comment_father": 0,
                            "comments": []
                        }
                    }
        '400':
          description: 'Error: Bad Request'
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResult'
              examples:
                Bad Request:
                  value: |-
                      {
                          "status": 400,
                          "error": "Bad Request",
                          "message": "User with id: 1 is the author of the comment with id: 1"
                      }
                      
                AlreadyUpvotedComment:
                  value: |-
                    {
                        "status": 400,
                        "error": "Bad Request",
                        "message": "User with id: 1 has already upvoted comment with id: 2"
                    }
        '401':
          description: 'Error: Unauthorized'
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResult'
              examples:
                Unauthorized:
                  value: |-
                    {
                        "status": 401,
                        "error": "Unauthorized",
                        "message": "API key not found"
                    }
        '404':
          description: 'Error: Not Found'
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResult'
              examples:
                NotFound:
                  value: |-
                    {
                        "status": 404,
                        "error": "Not Found",
                        "message": "Comment with id: 123 doesn't exist in our database"
                    }
                  
  /comments/{id}/unvote:
    put:
      tags:
      - comments
      summary: Unvote a Comment
      parameters:
      - name: id
        in: path
        description: Comment id to unvote
        required: true
        schema:
          type: integer
          format: int64
      responses:
        '200':
          description: Unvoted Comment
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Comment'
              examples:
                Upvoted Comment:
                  value: |-
                    {
                        "status": 200,
                        "message": "User with id: 1 has successfully unvoted comment with id: 2",
                        "comment": {
                            "UpVotes": 1,
                            "id": 2,
                            "author": "Alexandru-D6",
                            "comment": "dfgsdgfsdfgdsfdfd",
                            "created_at": "2022-05-09T21:31:04.594Z",
                            "id_submission": 2,
                            "id_comment_father": 0,
                            "comments": []
                        }
                    }
        '400':
          description: 'Error: Bad Request'
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResult'
              examples:
                Bad Request:
                  value: |-
                    {
                        "status": 400,
                        "error": "Bad Request",
                        "message": "User with id: 1 is the author of the comment with id: 1"
                    }
                Already upvoted comment:
                  value: |-
                    {
                        "status": 400,
                        "error": "Bad Request",
                        "message": "User with id: 1 has already unvoted comment with id: 2"
                    }
        '401':
          description: 'Error: Unauthorized'
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResult'
              examples:
                Unauthorized:
                  value: |-
                    {
                        "status": 401,
                        "error": "Unauthorized",
                        "message": "API key not found"
                    }
        '404':
          description: 'Error: Not Found'
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResult'
              examples:
                Not Found:
                  value: |-
                    {
                        "status": 404,
                        "error": "Not Found",
                        "message": "Comment with id: 123 doesn't exist in our database"
                    }
  /user/{name}:
    get:
      tags:
      - user
      summary: Retrieves all comments voted by a user
      description: Returns all the comments voted of a user
      parameters:
      - name: name
        in: path
        description: ID of Comment to return
        required: true
        schema:
          type: integer
          format: int64
      responses:
        200:
          description: successful operation
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Comment'
        404:
          description: 'Error: Not Found'
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResult'
              examples:
                errorExample:
                  $ref: '#/components/examples/error404'
  /user/{id}/comments:
    get:
      tags:
      - user
      summary: Retrieves all comments done by a user
      description: Returns all the comments of a user
      operationId: getCommentById
      parameters:
      - name: commentId
        in: path
        description: ID of Comment to return
        required: true
        schema:
          type: integer
          format: int64
      responses:
        200:
          description: successful operation
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Comment'
        404:
          description: 'Error: Not Found'
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResult'
              examples:
                errorExample:
                  $ref: '#/components/examples/error404'
  /user/{id}/edit:
    post:
      tags:
      - user
      summary: Edit about information
      description: Returns ??
      operationId: getCommentById ??
      parameters:
      - name: commentId
        in: path
        description: ID of Comment to return
        required: true
        schema:
          type: integer
          format: int64
      responses:
        200:
          description: successful operation
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Comment'
        404:
          description: 'Error: Not Found'
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResult'
              examples:
                errorExample:
                  $ref: '#/components/examples/error404'
  /user/submissions/userID:
    get:
      tags:
      - user
      summary: Obté el llistat de submissions de l'usuari amb userID.
      operationId: getUserSubmissions
      parameters:
        - name: userID
          in: path
          description: ID de l'usuari del que volem el llistat de submissions.
          required: true
          schema:
            type: integer
      responses:
        200:
          description: operació finalitzada amb éxit
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AddTweetResult'
        404:
          description: 'Error: Not Found'
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResult'
              examples:
                errorExample:
                  $ref: '#/components/examples/error404'
  
  /user/submissions/voted/userID:
    get:
      tags:
      - user
      summary: Obté el llistat de submissions que ha votat l'usuari amb userID.
      operationId: getUserVotedSubmissions
      parameters:
        - name: userID
          in: path
          description: ID de l'usuari del que volem el llistat de submissions votades.
          required: true
          schema:
            type: integer
      responses:
        200:
          description: operació finalitzada amb éxit
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AddTweetResult'
        404:
          description: 'Error: Not Found'
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResult'
              examples:
                errorExample:
                  $ref: '#/components/examples/error404'     
  
components:
  schemas:
    Comment:
      type: object
      properties:
        id:
          type: integer
          format: int64
          example: 2
        author:
          type: string
          minLength: 4
          example: 'My name'
        content:
          type: string
          minLength: 4
          maxLength: 280
          example: 'My content'
        likes:
          type: integer
          format: int32
        created_at:
          type: string
          format: date-time
        _links:
          type: object
          properties:
            self:
              type: string
              format: url
              example: 'https://asw-api-demo.herokuapp.com/comment/2'
    AddCommentResult:
      type: object
      properties:
        new_comment:
          $ref: '#/components/schemas/Comment'
        api_key:
          type: string
          example: "MjAyMC0wNC0xOCAxMjoyODo0MSBVVEM=\n"
    ErrorResult:
      type: object
      properties:
        status:
          type: integer
          enum: [400, 401, 403, 404, 409]
        error: 
          type: string
          enum: ["Bad Request", "Unauthorized", "Forbidden", "Not Found", "Conflict"]
        message: 
          type: string
    Tweet:
      type: object
      properties:
        id:
          type: integer
          format: int64
          example: 2
        author:
          type: string
          minLength: 4
          example: 'My name'
        content:
          type: string
          minLength: 4
          maxLength: 280
          example: 'My content'
        likes:
          type: integer
          format: int32
        created_at:
          type: string
          format: date-time
        _links:
          type: object
          properties:
            self:
              type: string
              format: url
              example: 'https://asw-api-demo.herokuapp.com/tweets/2'
    AddTweetResult:
      type: object
      properties:
        new_tweet:
          $ref: '#/components/schemas/Tweet'
        api_key:
          type: string
          example: "MjAyMC0wNC0xOCAxMjoyODo0MSBVVEM=\n"
  examples:
    error400:
      value:
        status: 400
        error: "Bad Request"
        message: "Content is too long (maximum is 280 characters)"
    error401:
      value:
        status: 401
        error: "Unauthorized"
        message: "You provided no api key (X-API-KEY Header)"
    error403:
      value:
        status: 403
        error: "Forbidden"
        message: "Your api key (X-API-KEY Header) is not valid"
    error404:
      value:
        status: 404
        error: "Not Found"
        message: "No Comment with that ID"
  securitySchemes:
    ApiKeyAuth:
      type: apiKey
      name: X-API-KEY #Custom headers in rails apps must have the X- prefix
      in: header